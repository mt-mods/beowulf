-- taken from https://github.com/S-S-X/dftest/blob/master/init.lua
local has_beerchat = minetest.get_modpath("beerchat")


local df = {
	"35445d24f",
	"5131675a6",
	"f3e741dad",
	"96a37aed3",
	"d08242316",
	"ce0d81a82",
	"b7abc8df2",
	"4f613bbf5",
	"c86dcd0f6",
	"b84ed7d0b",
	"26cfbda65",
	"6dc7a65d9",
	"7d7d4d675",
	"c47eae316",
	"880c9768a",
	"83d09ffaf",
	"138a002cf",
	"e0b4859e7",
	"63f7c96ec",
	"22f73e9f2",
	"5c06763e8",
	"4c6ab11d9",
	"7613d9bfe",
	"1309066be",
	"bc79c2344",
	"166968232",
	"e391ee435",
	"546ab256b",
	"d3780cefd",
	"d1c84ada2",
	"1fbbb7682",
	"74f5f033e",
	"607add326",
	"946f3030f",
	"b2f629d8d",
	"f97763dc7",
	"78b7d1019",
	"19e0528e3",
	"47d0882cc",
	"cca4254f7",
	"4fedc3a31",
	"dc67f669e",
	"906845a87",
	"3a4325902",
	"53c991c5f",
	"0c6e0c717",
	"e8faa2afb",
	"a4d914ba2",
	"a34c61093",
	"7250cf2c1",
	"f783f5939",
	"8b58465aa",
	"35c15567a",
	"0c9e7466e",
	"a1e61e561",
	"56d536ea5",
	"ce47003cc",
	"89995efee",
	"3df23e23c",
	"8b3eaf5b0",
	"0a285dd33",
	"4695222bc",
	"5bead7daa",
	"f825cf0e3",
	"eaa8a5132",
	"9633ad122",
	"b4e475726",
	"549025f6a",
	"eb6aca8b4",
	"8de51dae9",
	"a65251a7a",
	"eaec3645b",
	"fb4d54ee3",
	"50629cc6a",
	"3d74e17cc",
	"f9c632466",
	"843239c0b",
	"598e9bdbc",
	"7d327def8",
	"82216e147",
	"4dd5ecfc5",
	"128ac35a9",
	"b65db98bd",
	"3e7c5d720",
	"0aa63aafc",
	"9db80fc6f",
	"6bda686c0",
	"46237330d",
	"1f56317d5",
	"75ecaa217",
	"6ccb5835f",
	"244713971",
	"07e61e115",
	"3af10766f",
	"16d302c9a",
	"ad148587d",
	"1145b05ea",
	"c9221730d",
	"1799d5aa9",
	"a7dc1135e",
	"f1d9ac014",
	"06b72069d",
	"62958bd60",
	"00d51fbd5",
	"7cbe42b1d",
	"8bc7d49b3",
	"ea88dde4b",
	"f1ff05bf5",
	"35da7306d",
	"58e6b29d4",
	"1a7d3d818",
	"1e4f35492",
	"7e0f8fba0",
	"151e5782e",
	"7ed223686",
	"f8777a4fa",
	"28a560684",
	"c1aea404b",
	"3a718f12b",
	"3b596a96e",
	"847198edb",
	"bbcd24954",
	"80f416d51",
	"cb1915efa",
	"43ee069db",
	"faa32610e",
	"ee88f4b94",
	"c36ff3edb",
	"0a2c90f4c",
	"044a12666",
	"b9f8f0a23",
	"af085acbd",
	"0730ed216",
	"772c9629e",
	"9b1030cac",
	"2321e3da4",
	"90f66dad8",
	"8b4d27141",
	"d8b8c1d31",
	"6e6c68ba0",
	"79d0314d7",
	"770bde9c6",
	"e245151c5",
	"19205f6b3",
	"73b89703f",
	"248dedaba",
	"9dc3eb777",
	"80371bc16",
	"1c29f21e0",
	"3bed0981d",
	"622d54726",
	"9019e18b9",
	"107dec6c0",
	"f1760622e",
	"2675bcca1",
	"3d980cf57",
	"85574cb53",
	"f7a042223",
	"344fddc17",
	"678559bb6",
	"9194165cf",
	"064c25caa",
	"5a8610c2f",
	"83f59484d",
	"ffe3c2ae0",
	"45aa2516b",
	"f22339ed8",
	"408e39a1d",
	"eee0f960b",
	"39d7567c1",
	"305e0e0d3",
	"6796baec6",
	"5a2bf6634",
	"e610149c0",
	"a87805a94",
	"68f9263a2",
	"90d885506",
}

-- update list: git log --oneline --author eliasfleckenstein@web.de | sed -r 's/^([^ ]+) .*$/\t"\1",/'
-- replace above entries with output

local function dfver(s) for _,v in ipairs(df) do if s:find(v) then return v end end end

minetest.register_on_joinplayer(function(player)
	local name = player:get_player_name()
	local info = minetest.get_player_information(name)
	local version = info.version_string

	if not version then
		-- version not available
		return
	end

	local dfv = version:find("dragonfire") or dfver(version)
	if dfv then
		local msg = "Unsupported client detected: " .. dfv .. " player: " .. name
		minetest.log("action", "[beowulf] " .. msg)
		if has_beerchat then
			beerchat.send_on_channel("DF-Detect", beerchat.moderator_channel_name, msg)
		end

		if minetest.settings:get_bool("beowulf.dfdetect.enable_kick", false) then
			minetest.kick_player(name, "Unsupported client")
		end
	end

end)
